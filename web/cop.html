<html>
    <head>
        <title>KB API Demo</title>

        <!-- JQUERY -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- BOOTSTRAP -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous">

        <!-- PAGINATION -->
        <script type="text/javascript" src="js/jquery.simplePagination.js"></script>
        <link type="text/css" rel="stylesheet" href="css/simplePagination.css"/>

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
              integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
              crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
                crossorigin="anonymous"></script>

    </head>
    <style>

        body {
            padding-top: 50px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }

        .navbar-brand {
            background: transparent url(/images/logo_inverse.png) no-repeat top left !important;
            background-size: cover;
            width: 150px;
        }

        div.gallery {
            border: 1px solid #ccc;
        }

        div.gallery:hover {
            border: 1px solid #777;
        }

        div.gallery img {
            width: 100%;
            height: auto;
        }

        div.desc {
            padding: 15px;
            text-align: center;
        }

        * {
            box-sizing: border-box;
        }

        .responsive {
            padding: 0 6px;
            float: left;
            width: 24.99999%;
        }

        @media only screen and (max-width: 700px) {
            .responsive {
                width: 49.99999%;
                margin: 6px 0;
            }
        }

        @media only screen and (max-width: 500px) {
            .responsive {
                width: 100%;
            }
        }

        .clearfix:after {
            content: "";
            display: table;
            clear: both;
        }

    </style>

    <body>
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                            aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"></a>
                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/index.jsp">DSFL</a></li>
                        <li class="active"><a href="/cop.html">COP</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container">
            <div class="starter-template">
                <div class="row">
                    <form id="form" class="form-inline">
                        <div class="form-group">
                            <select class="selectpicker form-control" name="editions" id="editions">
                            </select>
                        </div>
                        <div class="form-group">

                            <input type="text" placeholder="Search" class="form-control" id="query">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Not before YYYY-MM-DD" class="form-control" id="notBefore">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Not after YYYY-MM-DD" class="form-control" id="notAfter">
                        </div>

                        <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="pagination"></div>
                <br>
                <div id="total"></div>
                <div id="url"></div>
                <br>
                <div id="content"></div>
            </div>
        </div>
    </body>

    <script>


        var pagination;
        var xhr;

        function getData(currentPage) {

            //Display the url
            var url = "rest/api/cop?itemsPerPage=50"
                + "&id=" + $('#editions').val()
                + "&query=" + $('#query').val()
                + "&after=" + $('#notAfter').val()
                + "&before=" + $('#notBefore').val()
                + "&page=" + currentPage;
            var html = "<h3>URL</h3><strong>JSON: </strong>http://localhost:8080/" + url;
            html += "<br><strong>RSS: </strong> http://www.kb.dk/cop/syndication" + $('#editions').val() + "?itemsPerPage=50&query=" + $('#query').val() + "&page=" + currentPage  + "&" + "notBefore=" + $('#notBefore').val()+ "&notAfter=" + $('#notAfter').val() + "&format=rss";
            html += "<br><strong>KML: </strong> http://www.kb.dk/cop/syndication" + $('#editions').val() + "?itemsPerPage=50&query=" + $('#query').val() + "&page=" + currentPage  + "&" +  "notBefore=" + $('#notBefore').val()+ "&notAfter=" + $('#notAfter').val()+ "&format=kml";
            html += "<br><strong>MODS: </strong> http://www.kb.dk/cop/syndication" + $('#editions').val() + "?itemsPerPage=50&query=" + $('#query').val() + "&page=" + currentPage  + "&" + "notBefore=" + $('#notBefore').val() + "&notAfter=" + $('#notAfter').val()+ "&format=mods";
            $('#url').html(html);

            //Abort on new request
            if (xhr != null){
                xhr.abort();
            }

            //Get data
            xhr = $.ajax({
                dataType: "json",
                url: url,
                success: function (data, textStatus, response) {
                    $('#total').html('Total number of items: ' + response.getResponseHeader('total'));

                    var html = '';
                    $.each(data, function (i, row) {
                        html += ' <div class="responsive"><div class="gallery">' +
                            '<a target="_blank" href="' + row['link'] + '">' +
                            '<img src="' + row['thumbnailURI'] + '"></a> ' +
                            '<div class="desc">' + row['title'] + '</div>' +
                            '</div>' +
                            '</div>';
                    });
                    $('#content').html(html);

                    //initialise the pagination
                    initializePagination(response.getResponseHeader('Pagination-Count'));

                },
                error: function () {
                    $('#content').html('<div class="alert alert-info"><strong>Sorry</strong> No data available</div>');
                }
            });
        }
        ;

        function getEditions() {

            $.ajax({
                dataType: "json",
                url: "rest/api/editions",
                success: function (data) {
                    var html = ' <option value="">Select an edition</option>';
                    $.each(data, function (i, row) {
                        html += ' <option value="' + row['identifier'] + '">' + row['title'] + '</option>';
                    });
                    $('#editions').html(html);
                }
            });
        }

        function initializePagination(totalPage) {

            if (pagination != null && totalPage != pagination.pagination('getPagesCount')) {
                pagination.pagination('updateItems', totalPage);
            } else {
                pagination = $('.pagination').pagination({
                    pages: totalPage,
                    cssStyle: 'compact-theme',
                    onPageClick: function (pageNumber, event) {
                        getData(pageNumber);
                    }
                });
            }
        }

        $(document).ready(function () {

            getEditions();

            $('#editions').on('change', function() {
                getData(1);
            })

            $("#form").submit(function (event) {
                getData(1);
                event.preventDefault();
            });
        });
    </script>

</html>
